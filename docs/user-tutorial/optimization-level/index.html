<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.1">
<link rel="alternate" type="application/rss+xml" href="/MS-AMP/blog/rss.xml" title="MS-AMP Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/MS-AMP/blog/atom.xml" title="MS-AMP Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="MS-AMP" href="/MS-AMP/opensearch.xml"><title data-react-helmet="true">Optimization Level | MS-AMP</title><meta data-react-helmet="true" property="og:url" content="https://azure.github.io/MS-AMP/docs/user-tutorial/optimization-level"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Optimization Level | MS-AMP"><meta data-react-helmet="true" name="description" content="Currently MS-AMP supports three optimization levels: O1 and O2 and O3. The three levels gradually incorporate 8-bit collective communication, optimizer and distributed parallel training in an incremental manner. Users can directly set O1/O2 using msamp.initialize and set O3 in config file when using DeepSpeed."><meta data-react-helmet="true" property="og:description" content="Currently MS-AMP supports three optimization levels: O1 and O2 and O3. The three levels gradually incorporate 8-bit collective communication, optimizer and distributed parallel training in an incremental manner. Users can directly set O1/O2 using msamp.initialize and set O3 in config file when using DeepSpeed."><link data-react-helmet="true" rel="shortcut icon" href="/MS-AMP/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://azure.github.io/MS-AMP/docs/user-tutorial/optimization-level"><link data-react-helmet="true" rel="alternate" href="https://azure.github.io/MS-AMP/docs/user-tutorial/optimization-level" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://azure.github.io/MS-AMP/docs/user-tutorial/optimization-level" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/MS-AMP/assets/css/styles.9f188c0d.css">
<link rel="preload" href="/MS-AMP/assets/js/runtime~main.dfe48048.js" as="script">
<link rel="preload" href="/MS-AMP/assets/js/main.38105688.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ shadow--md">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/MS-AMP/"><img src="/MS-AMP/img/logo.svg" alt="Docusaurus Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/MS-AMP/img/logo.svg" alt="Docusaurus Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">MS-AMP</b></a><a class="navbar__item navbar__link navbar__link--active" href="/MS-AMP/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/MS-AMP/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/azure/MS-AMP" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/MS-AMP/"><img src="/MS-AMP/img/logo.svg" alt="Docusaurus Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/MS-AMP/img/logo.svg" alt="Docusaurus Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">MS-AMP</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/MS-AMP/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/MS-AMP/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/azure/MS-AMP" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu menu--responsive thin-scrollbar menu_cyFh" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/MS-AMP/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/MS-AMP/docs/getting-started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/MS-AMP/docs/getting-started/run-msamp">Run Examples</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">User Tutorial</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/MS-AMP/docs/user-tutorial/usage">Use MS-AMP</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/MS-AMP/docs/user-tutorial/optimization-level">Optimization Level</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/MS-AMP/docs/user-tutorial/container-images">Container Images</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/MS-AMP/docs/developer-guides/development">Development</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/MS-AMP/docs/developer-guides/using-docker">Using Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/MS-AMP/docs/developer-guides/contributing">Contributing</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="markdown"><header><h1 class="h1Heading_dC7a">Optimization Level</h1></header><p>Currently MS-AMP supports three optimization levels: O1 and O2 and O3. The three levels gradually incorporate 8-bit collective communication, optimizer and distributed parallel training in an incremental manner. Users can directly set O1/O2 using <code>msamp.initialize</code> and set O3 in config file when using DeepSpeed.</p><ul><li><p>O1: We found that directly transitioning weight gradients from FP32 to FP8 in the Transformer Engine leads to a decrease in accuracy. However, this issue is resolved in O1 through the implementation of FP8 for weight gradients and AllReduce communication. This optimization also has the added benefits of saving GPU memory and reducing communication bandwidth.</p></li><li><p>O2: From O1 to O2, our main focus is on enabling the use of low-bit data formats for auxiliary tensors in the Adam/AdamW optimizer without any loss in accuracy. Specifically, we are able to maintain accuracy by representing the first-order optimizer state in FP8 and the second-order state in FP16. This optimization has the potential to save up to 62.5% of GPU memory for the optimizer when the model size is particularly large.</p></li><li><p>O3: This optimization level is specifically designed for FP8 support in distributed parallel training for large scale models. These frequently-used strategies include data parallelism, tensor parallelism, pipeline parallelism, sequence parallelism and ZeRO optimizer. ZeRO separates model weights into regular weights and master weights, with the former used for network forward/backward on each GPU, and the latter used for model updating in the optimizer. This separation allows us to use 8-bit data precision for regular weights and weight broadcasting, which reduces GPU memory and bandwidth usage even further.</p></li></ul><p>Here are details of different MS-AMP optimization levels:</p><table><thead><tr><th>Optimization Level</th><th>Computation(GEMM)</th><th>Comm</th><th>Weight</th><th>Master Weight</th><th>Weight Gradient</th><th>Optimizer States</th></tr></thead><tbody><tr><td>FP16 AMP</td><td>FP16</td><td>FP32</td><td>FP32</td><td>N/A</td><td>FP32</td><td>FP32+FP32</td></tr><tr><td>Nvidia TE</td><td>FP8</td><td>FP32</td><td>FP32</td><td>N/A</td><td>FP32</td><td>FP32+FP32</td></tr><tr><td>MS-AMP O1</td><td>FP8</td><td>FP8</td><td>FP16</td><td>N/A</td><td>FP8</td><td>FP32+FP32</td></tr><tr><td>MS-AMP O2</td><td>FP8</td><td>FP8</td><td>FP16</td><td>N/A</td><td>FP8</td><td>FP8+FP16</td></tr><tr><td>MS-AMP O3</td><td>FP8</td><td>FP8</td><td>FP8</td><td>FP16</td><td>FP8</td><td>FP8+FP16</td></tr></tbody></table></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/azure/MS-AMP/edit/main/website/../docs/user-tutorial/optimization-level.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_wj+Z"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/MS-AMP/docs/user-tutorial/usage"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Use MS-AMP</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/MS-AMP/docs/user-tutorial/container-images"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Container Images Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/MS-AMP/docs/introduction">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/MS-AMP/docs/getting-started/installation">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Azure/MS-AMP/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues</a></li><li class="footer__item"><a href="https://github.com/Azure/MS-AMP/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussion</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/MS-AMP/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/Azure/MS-AMP" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 MS-AMP. <br> Built with Docusaurus and hosted by GitHub.</div></div></div></footer></div>
<script src="/MS-AMP/assets/js/runtime~main.dfe48048.js"></script>
<script src="/MS-AMP/assets/js/main.38105688.js"></script>
</body>
</html>
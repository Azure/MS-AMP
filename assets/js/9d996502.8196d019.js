"use strict";(self.webpackChunkmsamp_website=self.webpackChunkmsamp_website||[]).push([[600],{3905:function(t,e,n){n.d(e,{Zo:function(){return m},kt:function(){return c}});var r=n(7294);function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,r,a=function(t,e){if(null==t)return{};var n,r,a={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(a[n]=t[n]);return a}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}var u=r.createContext({}),p=function(t){var e=r.useContext(u),n=e;return t&&(n="function"==typeof t?t(e):l(l({},e),t)),n},m=function(t){var e=p(t.components);return r.createElement(u.Provider,{value:e},t.children)},s={inlineCode:"code",wrapper:function(t){var e=t.children;return r.createElement(r.Fragment,{},e)}},d=r.forwardRef((function(t,e){var n=t.components,a=t.mdxType,i=t.originalType,u=t.parentName,m=o(t,["components","mdxType","originalType","parentName"]),d=p(n),c=a,g=d["".concat(u,".").concat(c)]||d[c]||s[c]||i;return n?r.createElement(g,l(l({ref:e},m),{},{components:n})):r.createElement(g,l({ref:e},m))}));function c(t,e){var n=arguments,a=e&&e.mdxType;if("string"==typeof t||a){var i=n.length,l=new Array(i);l[0]=d;var o={};for(var u in e)hasOwnProperty.call(e,u)&&(o[u]=e[u]);o.originalType=t,o.mdxType="string"==typeof t?t:a,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9987:function(t,e,n){n.r(e),n.d(e,{contentTitle:function(){return u},default:function(){return d},frontMatter:function(){return o},metadata:function(){return p},toc:function(){return m}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),l=["components"],o={id:"optimization-level"},u="Optimization Level",p={unversionedId:"user-tutorial/optimization-level",id:"user-tutorial/optimization-level",isDocsHomePage:!1,title:"Optimization Level",description:"Currently MS-AMP supports three optimization levels: O1 and O2 and O3. The three levels gradually incorporate 8-bit collective communication, optimizer and distributed parallel training in an incremental manner. Users can directly set O1/O2 using msamp.initialize and set O3 in config file when using DeepSpeed.",source:"@site/../docs/user-tutorial/optimization-level.md",sourceDirName:"user-tutorial",slug:"/user-tutorial/optimization-level",permalink:"/MS-AMP/docs/user-tutorial/optimization-level",editUrl:"https://github.com/azure/MS-AMP/edit/main/website/../docs/user-tutorial/optimization-level.md",version:"current",frontMatter:{id:"optimization-level"},sidebar:"docs",previous:{title:"Use MS-AMP",permalink:"/MS-AMP/docs/user-tutorial/usage"},next:{title:"Container Images",permalink:"/MS-AMP/docs/user-tutorial/container-images"}},m=[],s={toc:m};function d(t){var e=t.components,n=(0,a.Z)(t,l);return(0,i.kt)("wrapper",(0,r.Z)({},s,n,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"optimization-level"},"Optimization Level"),(0,i.kt)("p",null,"Currently MS-AMP supports three optimization levels: O1 and O2 and O3. The three levels gradually incorporate 8-bit collective communication, optimizer and distributed parallel training in an incremental manner. Users can directly set O1/O2 using ",(0,i.kt)("inlineCode",{parentName:"p"},"msamp.initialize")," and set O3 in config file when using DeepSpeed."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"O1: We found that directly transitioning weight gradients from FP32 to FP8 in the Transformer Engine leads to a decrease in accuracy. However, this issue is resolved in O1 through the implementation of FP8 for weight gradients and AllReduce communication. This optimization also has the added benefits of saving GPU memory and reducing communication bandwidth.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"O2: From O1 to O2, our main focus is on enabling the use of low-bit data formats for auxiliary tensors in the Adam/AdamW optimizer without any loss in accuracy. Specifically, we are able to maintain accuracy by representing the first-order optimizer state in FP8 and the second-order state in FP16. This optimization has the potential to save up to 62.5% of GPU memory for the optimizer when the model size is particularly large.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"O3: This optimization level is specifically designed for FP8 support in distributed parallel training for large scale models. These frequently-used strategies include data parallelism, tensor parallelism, pipeline parallelism, sequence parallelism and ZeRO optimizer. ZeRO separates model weights into regular weights and master weights, with the former used for network forward/backward on each GPU, and the latter used for model updating in the optimizer. This separation allows us to use 8-bit data precision for regular weights and weight broadcasting, which reduces GPU memory and bandwidth usage even further."))),(0,i.kt)("p",null,"Here are details of different MS-AMP optimization levels:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Optimization Level"),(0,i.kt)("th",{parentName:"tr",align:null},"Computation(GEMM)"),(0,i.kt)("th",{parentName:"tr",align:null},"Comm"),(0,i.kt)("th",{parentName:"tr",align:null},"Weight"),(0,i.kt)("th",{parentName:"tr",align:null},"Master Weight"),(0,i.kt)("th",{parentName:"tr",align:null},"Weight Gradient"),(0,i.kt)("th",{parentName:"tr",align:null},"Optimizer States"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"FP16 AMP"),(0,i.kt)("td",{parentName:"tr",align:null},"FP16"),(0,i.kt)("td",{parentName:"tr",align:null},"FP32"),(0,i.kt)("td",{parentName:"tr",align:null},"FP32"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A"),(0,i.kt)("td",{parentName:"tr",align:null},"FP32"),(0,i.kt)("td",{parentName:"tr",align:null},"FP32+FP32")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Nvidia TE"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP32"),(0,i.kt)("td",{parentName:"tr",align:null},"FP32"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A"),(0,i.kt)("td",{parentName:"tr",align:null},"FP32"),(0,i.kt)("td",{parentName:"tr",align:null},"FP32+FP32")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"MS-AMP O1"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP16"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP32+FP32")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"MS-AMP O2"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP16"),(0,i.kt)("td",{parentName:"tr",align:null},"N/A"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8+FP16")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"MS-AMP O3"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP16"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8"),(0,i.kt)("td",{parentName:"tr",align:null},"FP8+FP16")))))}d.isMDXComponent=!0}}]);